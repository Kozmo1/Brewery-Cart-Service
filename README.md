# Brewery-Cart-Service

Created by Joel Attard, Shahyar Fida, Mike Kraemer, Julia Lebedzeva

This project is a Node.js-based microservice for managing shopping carts in an e-commerce application, developed as part of a group project for Open Source Web Programming at Conestoga College. It handles adding items, fetching carts, updating quantities, removing items, clearing carts, and calculating totals, all tied to the Brewery Database Service via RESTful APIs. We built it with TypeScript, Express, and Jest to keep it solid, secure, and testable—aiming for 90%+ branch coverage. The service uses `dotenv-safe` to load environment variables from `.env.local` by default or based on `NODE_ENV`. Key settings include the server port (default: 3009), Brewery API URL (default: http://localhost:5089), and a JWT secret for auth. The `CartController` class runs the show, using Axios for API calls and express-validator for input checks.

To get started, clone the repo from `C:\git\Brewery-Cart-Service` (or your fork), then run `npm install` to grab dependencies like `express`, `axios`, `jsonwebtoken`, `dotenv-safe`, and `express-validator`. For dev work, add `typescript`, `jest`, `@types/*` packages, and `ts-node` with `npm install --save-dev`. Set up a `.env.local` file with `PORT`, `JWT_SECRET`, `BREWERY_API_URL`, and `NODE_ENV`, using `.env.example` as a guide. Start the service with `npm start` (assuming `ts-node src/index.ts`), or compile with `npm run build` and run `node dist/index.js`. Test it with `npm run test` to hit Jest with coverage—shooting for 100%.

The project’s laid out with `src/config/config.ts` for env setup, `src/controllers/cartController.ts` for the core logic, `src/middleware/auth.ts` for JWT checks, and `src/index.ts` to kick things off. Tests are in `src/config/__tests__/config.test.ts` and `src/controllers/__tests__/cartController.test.ts`, mocking Axios and express-validator. Below are the endpoints, all under `/cart` and expecting JSON content type. All routes need a Bearer token in the `Authorization` header.

1. `POST /add` - Adds an item to the cart. Example input: `{"user_id": 1, "inventory_id": 1, "quantity": 2}` with header `Authorization: Bearer <token>`. Success response (201): `{"id": 1, "user_id": 1, "inventory_id": 1, "quantity": 2}`. Error (400): `{"errors": [{"msg": "Quantity must be at least 1"}]}`.
2. `GET /:user_id` - Fetches a user’s cart. Example request: `GET /cart/1`. Success response (200): `[{"id": 1, "user_id": 1, "inventory_id": 1, "quantity": 2}]`. Error (403): `{"message": "Unauthorized"}`.
3. `PUT /update/:id` - Updates a cart item’s quantity. Example input: `{"quantity": 3}` with header `Authorization: Bearer <token>`. Success response (200): `{"id": 1, "quantity": 3}`. Error (400): `{"message": "Insufficient stock"}`.
4. `DELETE /remove/:id` - Removes an item from the cart. Example request: `DELETE /cart/remove/1`. Success response (200): `{"message": "Item removed"}`. Error (403): `{"message": "Unauthorized"}`.
5. `DELETE /clear/:user_id` - Clears a user’s cart. Example request: `DELETE /cart/clear/1`. Success response (200): `{"message": "Cart cleared successfully"}`. Error (403): `{"message": "Unauthorized"}`.
6. `GET /:user_id/total` - Calculates the cart total. Example request: `GET /cart/1/total`. Success response (200): `{"total": 15.97}`. Error (404): `{"message": "Cart not found"}`.
